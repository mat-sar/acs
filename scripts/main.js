"use strict";(function(){var i="spec-chapter";var e="spec-comment";var t=document.getElementsByClassName(i).length>0;var n=document.getElementsByClassName(e).length>0;if(!t&&!n){return}var a=new o(i);var c=new l(e);var s=new r;if(!t){c.addCloseButton();c.underlyingElement.before(a.underlyingElement);c.open();(function(){var e=window.location.href;var t=s.getSpecUrlFromCommentUrl(e);a.loadContent(t,function(){a.updateFragmentLinks(s.getSpecPageNameFromSpecUrl(t));a.highlightAndScrollToSpecFragment(s.getCommentIdFromCommentUrl(e))})})()}if(!n){a.updateFragmentLinks(s.getSpecPageNameFromSpecUrl(window.location.href));a.underlyingElement.after(c.underlyingElement);c.showNoCommentSelectedMessage()}(function(){var e=sessionStorage.getItem("specScrollPosition");var t=sessionStorage.getItem("commentScrollPosition");if(e){a.underlyingElement.scrollTop=e}if(t){c.underlyingElement.scrollTop=t}})();window.addEventListener("unload",function(){sessionStorage.setItem("specScrollPosition",a.underlyingElement.scrollTop);sessionStorage.setItem("commentScrollPosition",c.underlyingElement.scrollTop)});window.onpopstate=function(){var e=window.location.href;m(e);if(s.isCommentUrl(e)){c.open(e);a.highlightAndScrollToSpecFragment(s.getCommentIdFromCommentUrl(e))}else{c.close();c.showNoCommentSelectedMessage();a.removeSpecFragmentHighlightIfAny();document.title=a.title}};document.addEventListener("click",function(e){var t=e.target.closest("a");if(t){var n=t.href;if(s.isCommentUrl(n)){e.preventDefault();if(t.pathname!=window.location.pathname){c.open(n);history.pushState("","",n);a.highlightSpecFragment(s.getCommentIdFromCommentUrl(n));m(n)}else if(t.hash){history.pushState("","",n);c.scrollToFragment(t.hash)}return}else if(t.hash&&t.closest("."+i)&&window.location.href.includes(t.pathname)){e.preventDefault();history.pushState("","",n);var r=t.hash.substring(1);var o=a.underlyingElement.querySelector("#"+r+", "+'[name="'+r+'"]');if(o){o.scrollIntoView()}}}else if(e.target.closest(".close-comment")){e.preventDefault();var l=s.getSpecUrlFromCommentUrl(window.location.href);history.pushState("","",l);c.close();c.showNoCommentSelectedMessage();a.removeSpecFragmentHighlightIfAny();document.title=a.title;m(l)}});function r(){var e=this;e.getSpecUrlFromCommentUrl=function(e){return e.replace(/\/comments\/.*/,"")};e.getSpecPageNameFromSpecUrl=function(e){return(e.match(/.*\/(.+?)(?:#|\?|$)/)||[])[1]};e.getCommentIdFromCommentUrl=function(e){return(e.match(/comments\/([\d\.\-]+)/)||[])[1]};e.isCommentUrl=function(e){return/comments\/([\d\.\-]+)/.test(e)}}function o(t){var l=this;var n="selected";l.selectedSpecFragment=null;l.title=null;l.underlyingElement=function(){var e=document.querySelector("."+t);if(e){l.title=document.title;return e}e=document.createElement("article");e.classList.add(t);return e}();l.highlightSpecFragment=function(e){if(!e)return;l.removeSpecFragmentHighlightIfAny();var t=document.getElementById(e);l.selectedSpecFragment=t;l.selectedSpecFragment.classList.add(n)};l.highlightAndScrollToSpecFragment=function(e){l.highlightSpecFragment(e);l.selectedSpecFragment.scrollIntoView()};l.removeSpecFragmentHighlightIfAny=function(){if(l.selectedSpecFragment){l.selectedSpecFragment.classList.remove(n)}};l.updateFragmentLinks=function(e){var t=l.underlyingElement.getElementsByTagName("a");var n;var r;for(var o=0;o<t.length;o++){n=t[o];r=n.getAttribute("href");if(!r||!r.startsWith("#"))continue;n.setAttribute("href","/"+e+r)}};l.loadContent=function(e,t){var n=new XMLHttpRequest;n.addEventListener("load",function(){l.underlyingElement.innerHTML=event.target.responseXML.body.getElementsByClassName("spec-chapter")[0].innerHTML;l.title=event.target.responseXML.title;if(t)t()});n.open("GET",e);n.responseType="document";n.send()}}function l(r){var o=this;o.underlyingElement=function(){var e=document.querySelector("."+r);if(e)return e;e=document.createElement("article");e.classList.add(r);return e}();o.showLoaderOverlay=function(){o.underlyingElement.innerHTML="";o.underlyingElement.appendChild(l)};o.showNoCommentSelectedMessage=function(){setTimeout(function(){o.underlyingElement.innerHTML="";o.underlyingElement.appendChild(t)},300)};o.addCloseButton=function(){o.underlyingElement.insertAdjacentElement("beforeend",e)};o.open=function(t){o.underlyingElement.classList.add("opened");if(!t)return;o.underlyingElement.scrollTop=0;o.showLoaderOverlay();var e=new XMLHttpRequest;e.addEventListener("load",function(e){n(e);if(t.includes("#")){o.scrollToFragment(t.substring(t.indexOf("#")+1))}});e.open("GET",t);e.responseType="document";e.send()};o.close=function(){o.underlyingElement.classList.remove("opened")};o.scrollToFragment=function(e){if(!e)return;var t=e.startsWith("#")?e:"#"+e;var n=o.underlyingElement.querySelector(t);if(!n)return;n.scrollIntoView()};var n=function(e){var t=e.target.responseXML;document.title=t.title;var n=t.body.querySelector("."+r);o.underlyingElement.innerHTML=n.innerHTML;o.addCloseButton()};var e=function(){var e=document.createElement("button");e.className="close-comment";e.innerHTML="Close comment";return e}();var t=function(){var e=document.createElement("div");e.classList.add("empty-comment-section-info");e.innerHTML=""+'<img class="comment-image" src="/images/no-comment-selected.svg" alt="" />'+"<h1>Comment panel</h1>"+'<p>Click <img class="comment-call-out" '+'src="/images/comment.svg" '+'alt="[C]" /> '+"next to a fragment of the spec to reveal a comment.</p>"+'<a href="/about">Learn more</a>';return e}();var l=function(){var e=document.createElement("div");e.classList.add("loader","la-ball-scale-pulse","la-3x");e.innerHTML="<div></div>";return e}()}function m(e){if(!window.hasOwnProperty("goatcounter"))return;goatcounter.count({path:e})}})();