<html lang="en"><head> <meta charset="utf-8"> <title>Collapse between bottom margins | Annotated CSS Spec </title> <meta name="description" content="Broaden your CSS knowledge by reading a specification enriched with explanations and examples."> <meta name="viewport" content="width=device-width,initial-scale=1"> <meta name="robots" content="noindex"> <meta property="og:title" content="Annotated CSS Spec"> <meta property="og:url" content="https://annotatedcss.com"> <meta property="og:description" content="Broaden your CSS knowledge by reading an annotated specification!"> <meta property="og:image" content="/images/logo.png"> <meta property="og:type" content="website"> <meta property="og:image:width" content="300"> <meta property="og:image:height" content="300"> <link href="https://fonts.googleapis.com/css2?family=Inconsolata&amp;family=Open+Sans:ital,wght@0,400;0,600;1,300;1,400&amp;display=swap" rel="stylesheet"> <link rel="stylesheet" href="/styles/main.css"> <link rel="icon" type="image/png" href="/images/favicon-16x16.png" sizes="16x16"> <link rel="icon" type="image/png" href="/images/favicon-32x32.png" sizes="32x32"> <link rel="icon" type="image/png" href="/images/favicon-96x96.png" sizes="96x96"> </head> <body> <header> <svg class="logo" xmlns="http://www.w3.org/2000/svg" width="50" height="50" viewBox="0 0 41.01 41.01"><g class="marginBox" fill="none" stroke="#ececfb" stroke-width="2.646"><path d="M1.323 7.938V1.323h6.615M1.323 11.898v6.614M1.323 22.488v6.614M7.937 39.688H1.323v-6.615M39.688 7.938V1.323h-6.615M39.688 11.898v6.614M39.688 22.488v6.614M33.073 39.688h6.614v-6.615M11.906 1.318h6.615M22.49 1.318h6.614M11.906 39.688h6.615M22.49 39.688h6.614"></path></g><rect class="borderBox" ry="0" height="25.261" width="25.261" y="7.87" x="7.875" opacity=".99" fill="none" stroke="#ececfb" stroke-width="2.52" stroke-linecap="round"></rect><rect class="contentBox" ry="0" height="14.552" width="14.552" y="13.23" x="13.229" opacity=".99" fill="#c7a6e7ff"></rect></svg> <a class="title" href="/">Annotated CSS&nbsp;Spec </a><a class="help-link" href="/about">?</a> </header> <main> <article class="spec-comment open" data-comment-on="/box-model.html"> <div class="content"> <div class="comment-identifier"> This comment relates to the following words from Section&nbsp;8.3.1 of CSS&nbsp;2.2: <blockquote> bottom margin of a last in-flow child and bottom margin of its parent if the parent has 'auto' computed height </blockquote> </div> <p> We will use an example which, unsurprisingly, includes a parent and a child element: </p> <pre><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>parent<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>child<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span></code></pre> <p> In terms of formatting, the most important property is <code class="language-css">margin-bottom</code>. We will set it to <code class="language-css">25px</code> for both the parent and the child. </p> <p>This is the result:</p> <div id="ex-8.3.1.15-i" class="example-visualization"> <style> #ex-8\.3\.1\.15-i .parent {
          background-color: #dfdff9;
          border-top: solid 1px #686892;
          margin-bottom: 25px;
        }

        #ex-8\.3\.1\.15-i .child {
          background-color: #705697;
          height: 50px;
          margin-bottom: 25px;
          margin-top: 25px;
          width: 50px;
        } </style> <div class="example-frame"> <div class="parent"> <div class="child"></div> </div> </div> </div> <p> The fact that the bottom outer edge of the child is aligned with the bottom outer edge of the parent indicates that the margin collapse took place. </p> <p> Note that the commented fragment of the spec speaks about the bottom margin of a last <em>in⁠-⁠flow</em> child. The last in⁠-⁠flow child might not necessarily be the last child in general. You can refer to <a href="/box-model/comments/8.3.1.13">another comment on margin collapse</a>, in which I described the similar case of why the <em>first</em> in⁠-⁠flow child might not be the first child in general. </p> <h3>Why the parent’s height is required to be auto</h3> <p> The commented fragment of the spec states that for the bottom margins of a parent and a child to collapse, the parent needs to have a <code class="language-css">height</code> of <code class="language-css">auto</code>. Why is this requirement present? </p> <p> The short answer is: to avoid contradiction. If we declare the parent’s height to be, say, 100&nbsp;px, then this height is supposed to stay at 100&nbsp;px. Margin collapse, if it applied, could interfere with that. </p> <p>Consider this diagram:</p> <img src="/images/8.3.1.15-parent-with-fixed-height.svg" alt="A box with a height of 100 px. The box contains a single child box
        with a height of 50 px. Both boxes have a non-zero positive bottom margin."> <p> If the two bottom margins were allowed to collapse, the parent’s margin would have to begin in the same place as the child’s margin. Thus, the height of the parent would have to be 50&nbsp;px. </p> <h3>Minimum and maximum height in margin collapse</h3> <p> Via the properties <code class="language-css">max-height</code> and <code class="language-css">min-height</code>, CSS allows for specifying a maximum and minimum height for a box. These height constraints have an interesting effect on margin collapse. </p> <p> Let’s take a parent and child <code class="language-html">&lt;div&gt;</code> elements. The child will have a height of 50&nbsp;px and a bottom margin of 40&nbsp;px. The parent will have <code class="language-css">height: auto</code> and <code class="language-css">min-height: 100px</code>. It will also have a bottom margin of 20&nbsp;px. </p> <p> Many of us would not consider the child’s bottom margin as adjoining to the parent’s bottom margin. That is, we would not expect these margins to collapse: </p> <img src="/images/8.3.1.15-parent-with-min-height-no-collapse.svg" alt="A parent and a child box. The child box has a height of 50 px and
      a bottom margin of 40 px. The parent box has a height of 100 px and a
      bottom margin of 20 px."> <p> After all, the parent has a height of 100&nbsp;px. And, as I said in the previous section, when a parent has a fixed height, there is no margin collapse. However, we have to be specific about what it means for a box to have a height. </p> <p> The key is the difference between the <em>computed</em> and the <em>used</em> values for <code class="language-css">height</code>. In the example, the used value for the parent’s height is <code class="language-css">100px</code>. The computed value is <code class="language-css">auto</code>. </p> <p> The spec fragment we’re discussing states that the child’s and the parent’s bottom margins will collapse if the parent has a computed height of <code class="language-css">auto</code>. The used value is not mentioned. This suggests that margin collapse should apply even if there is <code class="language-css">max-height</code> or <code class="language-css">min-height</code> defined on the parent. This interpretation is confirmed by <a href="https://www.w3.org/TR/CSS22/visudet.html#min-max-heights">Section&nbsp;10.7</a>. When listing the steps for calculating the height of a box, the section says: </p> <blockquote> These steps do not affect the real computed value of 'height'. Consequently, for example, they do not affect margin collapsing, which depends on the computed value. </blockquote> <p> So, the parent’s and the child’s bottom margins should collapse. The question is where to position the collapsed margin. If the parent didn’t have any minimum height, the effect would be as follows: </p> <img src="/images/8.3.1.15-bottom-margin-collapse-no-min-height.svg" alt="A parent and a child box. The child box has a height of 50 px. This box’s
    bottom margin collapses with the bottom margin of the parent. As a result, the
    height of the parent box is 50 px."> <p> In this case, the collapsed margin forces the parent to have a height of 50&nbsp;px. But in our example, the height is <em>required</em> to be at least 100&nbsp;pixels, via <code class="language-css">min-height: 100px</code>. </p> <p> Some browsers addressed this issue via something <a href="https://github.com/w3c/csswg-drafts/issues/2607#issuecomment-383586816"> astutely described as “margin teleportation”</a> by the developer Morten Stenshorne: </p> <img src="/images/8.3.1.15-margin-teleportation.svg" alt="A parent and a child box. The child has a height and width of 50 px, and a bottom
    margin of 30 px. The parent has a minimum height of 100 px, and a bottom margin of
    30 px. The two bottom margins collapse. The resulting margin is attached to the bottom
    border edge of the parent, which means it is separated from the child."> <p> The collapsed margin, which belongs to both the parent and the child, is “teleported” in the sense that it’s detached from the child. </p> <p> The teleportation approach was used by Chrome, among other browsers. I say “was used” because as I’m writing these words, Chrome seems to no longer collapse the margins. That is, the parent box has a height of 100&nbsp;px and a bottom margin of 10&nbsp;px. The child keeps its bottom margin of 30&nbsp;px. A similar approach (again, at the time of writing) can be found on Firefox. </p> <p>This is how your browser renders the example:</p> <div id="ex-8.3.1.15-ii" class="example-visualization"> <style> #ex-8\.3\.1\.15-ii .parent {
          background-color: #dfdff9;
          margin-bottom: 10px;
          min-height: 100px;
        }

        #ex-8\.3\.1\.15-ii .child {
          background-color: #705697;
          height: 50px;
          margin-bottom: 30px;
          width: 50px;
        }

        #ex-8\.3\.1\.15-ii .margin-indicator {
          background-color: #686892;
          color: white;
          font-size: smaller;
          margin: 0;
          padding: 1px;
          text-align: center;
        } </style> <div class="example-frame"> <div class="parent"> <div class="child"></div> </div> <div class="margin-indicator"> ↑&nbsp;Any empty space above? </div> </div> </div> </div> <div class="copyright-notice"> <p> <img alt="Creative Commons License" src="/images/CC_BY-SA_small.svg"> This work by <span xmlns:cc="http://creativecommons.org/ns#" property="cc:attributionName">Mateusz Sarnecki</span> is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a>. </p> </div> </article> </main> <script src="/scripts/main.js"></script> <!-- GoatCounter, privacy-sensitive web analytics --> <script data-goatcounter="https://msar.goatcounter.com/count" async="" src="//gc.zgo.at/count.js"></script> </body></html>