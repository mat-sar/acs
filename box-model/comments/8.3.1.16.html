<html lang="en"><head> <meta charset="utf-8"> <title> Own margin collapse | Annotated CSS Spec </title> <meta name="description" content="Broaden your CSS knowledge by reading a specification enriched with explanations and examples."> <meta name="viewport" content="width=device-width,initial-scale=1"> <meta property="og:title" content="Annotated CSS Spec"> <meta property="og:url" content="https://annotatedcss.com"> <meta property="og:description" content="Broaden your CSS knowledge by reading an annotated specification!"> <meta property="og:image" content="/images/logo.png"> <meta property="og:type" content="website"> <meta property="og:image:width" content="300"> <meta property="og:image:height" content="300"> <link href="https://fonts.googleapis.com/css2?family=Inconsolata&amp;family=Open+Sans:ital,wght@0,400;0,600;1,300;1,400&amp;display=swap" rel="stylesheet"> <link rel="canonical" href="https://annotatedcss.com/box-model/comments/8.3.1.16"> <link rel="stylesheet" href="/styles/main.css"> <link rel="icon" type="image/png" href="/images/favicon-16x16.png" sizes="16x16"> <link rel="icon" type="image/png" href="/images/favicon-32x32.png" sizes="32x32"> <link rel="icon" type="image/png" href="/images/favicon-96x96.png" sizes="96x96"> </head> <body> <header> <svg class="logo" xmlns="http://www.w3.org/2000/svg" width="50" height="50" viewBox="0 0 41.01 41.01"><g class="marginBox" fill="none" stroke="#ececfb" stroke-width="2.646"><path d="M1.323 7.938V1.323h6.615M1.323 11.898v6.614M1.323 22.488v6.614M7.937 39.688H1.323v-6.615M39.688 7.938V1.323h-6.615M39.688 11.898v6.614M39.688 22.488v6.614M33.073 39.688h6.614v-6.615M11.906 1.318h6.615M22.49 1.318h6.614M11.906 39.688h6.615M22.49 39.688h6.614"></path></g><rect class="borderBox" ry="0" height="25.261" width="25.261" y="7.87" x="7.875" opacity=".99" fill="none" stroke="#ececfb" stroke-width="2.52" stroke-linecap="round"></rect><rect class="contentBox" ry="0" height="14.552" width="14.552" y="13.23" x="13.229" opacity=".99" fill="#c7a6e7ff"></rect></svg> <a class="title" href="/">Annotated CSS&nbsp;Spec </a><a class="help-link" href="/about">?</a> </header> <main> <article class="spec-comment open" data-comment-on="/box-model.html"> <div class="content"> <div class="comment-identifier"> This comment relates to the following words from Section&nbsp;8.3.1 of CSS&nbsp;2.2: <blockquote> top and bottom margins of a box that does not establish a new block formatting context and that has zero computed 'min-height', zero or 'auto' computed 'height', and no in-flow children </blockquote> </div> <p> It is possible to create a box in which the top margin is immediately followed by the bottom margin. Under specific circumstances, these two adjacent margins will collapse. </p> <p> This type of collapse could be called “own margin collapse”. This is the term I’m going to use here. </p> <p> As mentioned, own margin collapse takes place under specific circumstances. The spec describes them in a long sentence, which can be broken down into a list of requirements: </p> <ul> <li>the box cannot establish a new block formatting context</li> <li> the box’s <code class="language-css">min-height</code> must be zero </li> <li> the box’s <code class="language-css">height</code> must be zero or <code class="language-css">auto</code> </li> <li>the box cannot have any in⁠-⁠flow children</li> </ul> <p> I won’t discuss block formatting contexts here, but you can learn about them in <a href="/box-model/comments/8.3.1.9">a previous comment</a> or, better yet, in <a href="https://www.w3.org/TR/CSS22/visuren.html#block-formatting">Section&nbsp;9.4.1</a>. </p> <p> To interpret the first requirement properly, we need to remember that margin collapse applies only to boxes that participate in a block formatting context. So, we can rewrite the requirement to say: “the box has to participate in a block formatting context, but it cannot establish a new such context itself”. </p> <p> The requirement means that own margin collapse can only take effect on a box with <code class="language-css">overflow: visible</code>, <code class="language-css">display: block</code>, and <code class="language-css">float: none</code>. Only with such settings do we have a box which participates in a block formatting context, but does not itself establish a new such context. </p> <p> The next two requirements for own margin collapse relate to the height of the self⁠-⁠collapsing box. The box must have <code class="language-css">min-height: 0</code> and <code class="language-css">height: 0</code> or <code class="language-css">height: auto</code>. The case of <code class="language-css">min-height</code> and <code class="language-css">height</code> both being zero is quite straightforward: it essentially means that for own margin collapse to happen, the box cannot have any height. This makes sense, as a non⁠-⁠zero content area would form a barrier between the top and the bottom margin. </p> <p> The case of <code class="language-css">min-height: 0</code> and <code class="language-css">height: auto</code> is actually similar, once we consider the last requirement from the list: that the box cannot have any in⁠-⁠flow children. If a box does not contain any in⁠-⁠flow children, then <code class="language-css">height: auto</code> means that the box’s height will be zero. (This follows from <a href="https://www.w3.org/TR/CSS22/visudet.html#normal-block">Section&nbsp;10.6.3.</a>) </p> <p> So, the last requirement means that if we add an in⁠-⁠flow child to a self⁠-⁠collapsing box, then this box’s top margin bottom margins are no longer considered adjoining. </p> <p> Note an interesting case, though. Suppose we have a box which undergoes own margin collapse. We now add an in⁠-⁠flow child to this box. By definition, the box’s top and bottom margin are no longer adjoining. Despite this, they could still collapse! This is the case if the child itself is a box which undergoes own margin collapse. In such a situation, we end up with four adjoining margins: </p> <img src="/images/8.3.1.16-self-collapsing-box-within-self-collapsing-box.svg" alt="A box where the top and bottom margins are adjoining to each other, and
      where the top margin is adjoining to the parent’s top margin, and the bottom
      margin is adjoining to the parent’s bottom margin."> <p> Note that the diagram above presents a situation in which margin collapse did not exist. </p> <p> The CSS spec allows margin collapse to take place on more than two margins at the same time. So, in our example, the four different margins become one. The effect of the collapse can be visualized like this: </p> <img src="/images/8.3.1.16-collapsed-parent-and-child-margins.svg" alt="A parent and a child box. The parent’s and the child’s vertical margins
    are all adjoining, with the result that they collapse into a single margin.
    That single margin is extends above the parent and the child."> <p> If you are wondering why the diagram shows the collapsed margin as positioned above the parent and the child, you can refer to <a href="/box-model/comments/8.3.1.34">the comment on collapse⁠-⁠through</a>. </p> <section> <h1>New BFCs and own margin collapse</h1> <p> One of the requirements for own margin collapse to take place is that the box cannot establish a new block formatting context (BFC). </p> <p> I believe this requirement is a consequence of how formatting contexts are generally treated in CSS. When a box establishes a new block formatting context, it is as if this box created a “mini page”. That is, this box gains some degree of independence from other boxes. </p> <p> This independence manifests itself in different ways, e.g. in a lack of margin collapse. For example, we can prevent a parent’s top margin from collapsing with its child’s top margin by ensuring that the parent establishes a new BFC. This effect is discussed in <a href="/box-model/comments/8.3.1.9#why-is-bfc-required">another comment</a>. </p> <p> I think that in the case of own margin collapse, the authors of the spec wanted to remain consistent. A box might not contain any in⁠-⁠flow children, it might have no height, no border, and no padding, but as long as it establishes a new BFC, it becomes “its own thing”, immune from margin collapse. </p> </section></div> <div class="copyright-notice"> <p> <img alt="Creative Commons License" src="/images/CC_BY-SA_small.svg"> This work by <span xmlns:cc="http://creativecommons.org/ns#" property="cc:attributionName">Mateusz Sarnecki</span> is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a>. </p> </div> </article> </main> <script src="/scripts/main.js"></script> <!-- GoatCounter, privacy-sensitive web analytics --> <script data-goatcounter="https://msar.goatcounter.com/count" async="" src="//gc.zgo.at/count.js"></script> </body></html>