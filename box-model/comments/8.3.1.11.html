<html lang="en"><head> <meta charset="utf-8"> <title> Phantom line boxes and margin collapse | Annotated CSS Spec </title> <meta name="description" content="Broaden your CSS knowledge by reading a specification enriched with explanations and examples."> <meta name="viewport" content="width=device-width,initial-scale=1"> <meta property="og:title" content="Annotated CSS Spec"> <meta property="og:url" content="https://annotatedcss.com"> <meta property="og:description" content="Broaden your CSS knowledge by reading an annotated specification!"> <meta property="og:image" content="/images/logo.png"> <meta property="og:type" content="website"> <meta property="og:image:width" content="300"> <meta property="og:image:height" content="300"> <link href="https://fonts.googleapis.com/css2?family=Inconsolata&amp;family=Open+Sans:ital,wght@0,400;0,600;1,300;1,400&amp;display=swap" rel="stylesheet"> <link rel="canonical" href="https://annotatedcss.com/box-model/comments/8.3.1.11"> <link rel="stylesheet" href="/styles/main.css"> <link rel="icon" type="image/png" href="/images/favicon-16x16.png" sizes="16x16"> <link rel="icon" type="image/png" href="/images/favicon-32x32.png" sizes="32x32"> <link rel="icon" type="image/png" href="/images/favicon-96x96.png" sizes="96x96"> </head> <body> <header> <svg class="logo" xmlns="http://www.w3.org/2000/svg" width="50" height="50" viewBox="0 0 41.01 41.01"><g class="marginBox" fill="none" stroke="#ececfb" stroke-width="2.646"><path d="M1.323 7.938V1.323h6.615M1.323 11.898v6.614M1.323 22.488v6.614M7.937 39.688H1.323v-6.615M39.688 7.938V1.323h-6.615M39.688 11.898v6.614M39.688 22.488v6.614M33.073 39.688h6.614v-6.615M11.906 1.318h6.615M22.49 1.318h6.614M11.906 39.688h6.615M22.49 39.688h6.614"></path></g><rect class="borderBox" ry="0" height="25.261" width="25.261" y="7.87" x="7.875" opacity=".99" fill="none" stroke="#ececfb" stroke-width="2.52" stroke-linecap="round"></rect><rect class="contentBox" ry="0" height="14.552" width="14.552" y="13.23" x="13.229" opacity=".99" fill="#c7a6e7ff"></rect></svg> <a class="title" href="/">Annotated CSS&nbsp;Spec </a><a class="help-link" href="/about">?</a> </header> <main> <article class="spec-comment open" data-comment-on="/box-model.html"> <div class="content"> <div class="comment-identifier"> This comment relates to the following words from Section&nbsp;8.3.1 of CSS&nbsp;2.2: <blockquote> (Note that certain zero-height line boxes (see 9.4.2) are ignored for this purpose.) </blockquote> </div> <p> A line box is the <q>rectangular area that contains the boxes that form a line</q>. If you don’t know this concept, you can read the opening paragraphs of <a href="https://www.w3.org/TR/CSS22/visuren.html#inline-formatting">Section&nbsp;9.4.2</a>. Alternatively, for a very basic introduction, you can look at the <a href="/box-model/comments/8.3.1.10">previous comment</a>. </p> <p> The spec enigmatically tells us that “certain zero⁠-⁠height line boxes” do not prevent margin collapse. Then it refers us to Section&nbsp;9.4.2, which explains what <i>certain</i> means in this context. The relevant fragment of the section is: </p> <blockquote cite="https://www.w3.org/TR/CSS22/visuren.html#phantom-line-box"> Line boxes that contain no text, no preserved white space, no inline elements with non-zero margins, padding, or borders, and no other in-flow content (such as images, inline blocks or inline tables), and do not end with a preserved newline must be treated as zero-height line boxes for the purposes of determining the positions of any elements inside of them, and must be treated as not existing for any other purpose. </blockquote> <p> We’ll unpack this complex sentence in a moment. But first, let me make a terminological remark. </p> <p> The type of boxes described in the sentence are not explicitly given any name by the spec. However, if you look at the source HTML of Section&nbsp;9.4.2, you will notice that the <code class="language-html">&lt;p&gt;</code> element which contains the description I quoted above has <code class="language-html">id="phantom-line-boxes"</code>. Phantom line boxes! It’s definitely helpful to have a short name for this kind of boxes. I’ve been wondering why the spec doesn’t explicitly use the name. Perhaps it didn’t make an editorial cut? </p> <p> All right, going back to the complex sentence. It can be paraphrased as follows. </p> <p> A line box is a phantom line box, <em>unless</em> it contains at least one of these: </p> <ul> <li>text</li> <li> whitespace that is preserved (such preservation is done with <code class="language-css">white-space: pre</code>, <code class="language-css">white-space: pre-wrap</code>, or <code class="language-css">white-space: pre-line</code>) </li> <li> at least one inline element that has a non⁠-⁠zero margin, non⁠-⁠zero padding, or a non⁠-⁠zero border </li> <li> any other in⁠-⁠flow content such as images, inline blocks or inline tables </li> <li> a <code class="language-html">&lt;br&gt;</code> element at the end (this is not said explicitly in the quoted fragment, but this is how the words <q>do not end with a preserved newline</q> can be interpreted in the context of HTML; I have borrowed this interpretation from <a href="https://lists.w3.org/Archives/Public/www-style/2010Sep/0074.html">a discussion on the CSS mailing list</a>) </li> </ul> <p> In oversimplified terms, phantom line boxes are line boxes that are “completely empty”. </p> <p> As the commented fragment of the spec states, phantom line boxes do not prevent margin collapse. For an example, consider this HTML: </p> <pre><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>Div 1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>Div 2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>Div 3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span></code></pre> <p> By default, <code class="language-html">&lt;span&gt;</code> elements are formatted as inline boxes. We will keep this default formatting here. And, because the <code class="language-html">&lt;span&gt;</code> is an inline box, it is also part of a line box. </p> <p> We’ll assign <code class="language-css">margin: 20px</code> to all <code class="language-html">&lt;div&gt;</code> elements. </p> <p> In the rendering below, we can see that the distances between the <code class="language-html">&lt;div&gt;</code> boxes are uniform. This shows that the line box formed by the <code class="language-html">&lt;span&gt;</code> didn’t prevent margin collapse. </p> <div id="ex-8.3.1.11-i" class="example-visualization"> <style> #ex-8\.3\.1\.11-i .example-frame div {
          background-color: #dfdff9;
          border: 1px solid #686892;
          height: 20px;
          line-height: 20px;
          margin: 20px;
          padding: 10px;
          text-align: center;
        } </style> <div class="example-frame"> <div>Div 1</div> <div>Div 2</div> <span> </span> <div>Div 3</div> </div> </div> <p> The line box didn’t prevent margin collapse because it is a phantom box. It is a phantom box because: </p> <ul> <li>there is no text in this line box</li> <li> there is no preserved whitespace in this line box (you might have noticed that the <code class="language-html">&lt;span&gt;</code> contains a space character; this space is, by default, not rendered by the browser) </li> <li> the only inline box that the line box contains, i.e.&nbsp;the <code class="language-html">&lt;span&gt;</code>, does not have any border, padding, or margin </li> <li> the only inline box that the line box contains, i.e.&nbsp;the <code class="language-html">&lt;span&gt;</code>, is not an inline block or an inline table </li> </ul> <p> Using CSS, we can change any of the above⁠-⁠listed conditions. In this way, we will make the line box a non⁠-⁠phantom line box. </p> <ul> <li> Add text to the line box by applying <code class="language-css">:before</code> or <code class="language-css">:after</code> on the <code class="language-html">&lt;span&gt;</code>. </li> <li> Make sure that the space character in the <code class="language-html">&lt;span&gt;</code> is preserved by using <code class="language-css">white-space: pre</code>. </li> <li> Add a border, padding or a margin to the <code class="language-html">&lt;span&gt;</code> box. </li> <li> Change the <code class="language-html">&lt;span&gt;</code> element into an inline block via <code class="language-css">display: inline-block</code>. </li> </ul> <p> The following example is an extended version of the previous. You can use the controls to apply one or more of the changes we’ve discussed above, to see how each prevents margin collapse. </p> <div id="ex-8.3.1.11-ii" class="example-visualization"> <style> #ex-8\.3\.1\.11-ii .example-frame div {
          background-color: #dfdff9;
          border: 1px solid #686892;
          height: 20px;
          line-height: 20px;
          margin: 20px;
          padding: 10px;
          text-align: center;
        }

        #ex-8\.3\.1\.11-ii-added-text:checked ~ .example-frame span::before {
          content: "Extra text";
        }

        #ex-8\.3\.1\.11-ii-preserved-whitespace:checked ~ .example-frame span {
          white-space: pre;
        }

        #ex-8\.3\.1\.11-ii-border:checked ~ .example-frame span {
          border: 1px solid #686892;
        }

        #ex-8\.3\.1\.11-ii-inline-block:checked ~ .example-frame span {
          display: inline-block;
        } </style> <input type="checkbox" id="ex-8.3.1.11-ii-added-text"><label for="ex-8.3.1.11-ii-added-text"> Add text to the <code class="language-html">&lt;span&gt;</code> using <code class="language-css">::before</code> </label><br> <input type="checkbox" id="ex-8.3.1.11-ii-preserved-whitespace"><label for="ex-8.3.1.11-ii-preserved-whitespace"> Apply <code class="language-css">white-space: pre</code> on the <code class="language-html">&lt;span&gt;</code></label><br> <input type="checkbox" id="ex-8.3.1.11-ii-border"><label for="ex-8.3.1.11-ii-border"> Add a border to the <code class="language-html">&lt;span&gt;</code></label><br> <input type="checkbox" id="ex-8.3.1.11-ii-inline-block"><label for="ex-8.3.1.11-ii-inline-block"> Change the <code class="language-html">&lt;span&gt;</code> into an inline block </label> <div class="example-frame"> <div>Div 1</div> <div>Div 2</div> <span> </span> <div>Div 3</div> </div> </div> <p> The greater distance between Div&nbsp;2 and Div&nbsp;3 is not only because their margins are prevented from collapsing. There is also some extra space contributed by the line box itself. The calculation of line box heights is a separate topic, though! </p> <p> Note that there can be a zero⁠-⁠height line box which is not a phantom box. Such non⁠-⁠phantom zero⁠-⁠height line boxes make margin collapse impossible, as illustrated in the <a href="/box-model/comments/8.3.1.10">previous comment</a>. </p> </div> <div class="copyright-notice"> <p> <img alt="Creative Commons License" src="/images/CC_BY-SA_small.svg"> This work by <span xmlns:cc="http://creativecommons.org/ns#" property="cc:attributionName">Mateusz Sarnecki</span> is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a>. </p> </div> </article> </main> <script src="/scripts/main.js"></script> <!-- GoatCounter, privacy-sensitive web analytics --> <script data-goatcounter="https://msar.goatcounter.com/count" async="" src="//gc.zgo.at/count.js"></script> </body></html>