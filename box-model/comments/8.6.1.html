<html lang="en"><head> <meta charset="utf-8"> <title>Inline boxes and bidirectional text | Annotated CSS Spec </title> <meta name="description" content="Broaden your CSS knowledge by reading a specification enriched with explanations and examples."> <meta name="viewport" content="width=device-width,initial-scale=1"> <meta name="robots" content="noindex"> <meta property="og:title" content="Annotated CSS Spec"> <meta property="og:url" content="https://annotatedcss.com"> <meta property="og:description" content="Broaden your CSS knowledge by reading an annotated specification!"> <meta property="og:image" content="/images/logo.png"> <meta property="og:type" content="website"> <meta property="og:image:width" content="300"> <meta property="og:image:height" content="300"> <link href="https://fonts.googleapis.com/css2?family=Inconsolata&amp;family=Open+Sans:ital,wght@0,400;0,600;1,300;1,400&amp;display=swap" rel="stylesheet"> <link rel="stylesheet" href="/styles/main.css"> <link rel="icon" type="image/png" href="/images/favicon-16x16.png" sizes="16x16"> <link rel="icon" type="image/png" href="/images/favicon-32x32.png" sizes="32x32"> <link rel="icon" type="image/png" href="/images/favicon-96x96.png" sizes="96x96"> </head> <body> <header> <svg class="logo" xmlns="http://www.w3.org/2000/svg" width="50" height="50" viewBox="0 0 41.01 41.01"><g class="marginBox" fill="none" stroke="#ececfb" stroke-width="2.646"><path d="M1.323 7.938V1.323h6.615M1.323 11.898v6.614M1.323 22.488v6.614M7.937 39.688H1.323v-6.615M39.688 7.938V1.323h-6.615M39.688 11.898v6.614M39.688 22.488v6.614M33.073 39.688h6.614v-6.615M11.906 1.318h6.615M22.49 1.318h6.614M11.906 39.688h6.615M22.49 39.688h6.614"></path></g><rect class="borderBox" ry="0" height="25.261" width="25.261" y="7.87" x="7.875" opacity=".99" fill="none" stroke="#ececfb" stroke-width="2.52" stroke-linecap="round"></rect><rect class="contentBox" ry="0" height="14.552" width="14.552" y="13.23" x="13.229" opacity=".99" fill="#c7a6e7ff"></rect></svg> <a class="title" href="/">Annotated CSS&nbsp;Spec </a><a class="help-link" href="/about">?</a> </header> <main> <article class="spec-comment open" data-comment-on="/box-model.html"> <div class="content"> <div class="comment-identifier"> This comment relates to the following words from Section&nbsp;8.6 of CSS&nbsp;2.2: <blockquote> For each line box, UAs must take the inline boxes generated for each element and render the margins, borders and padding in visual order (not logical order). </blockquote> </div> <p> This topic requires an understanding of line boxes. You can read about them in <a href="https://www.w3.org/TR/CSS22/visuren.html#inline-boxes">Section 9.2.2</a> and <a href="https://www.w3.org/TR/CSS22/visuren.html#inline-formatting">9.4.2</a>. For a very brief introduction, you can also refer to <a href="">one of the previous comments</a>. </p> <p> We are considering a section titled “The box model for inline elements in bidirectional context”. Bidirectional context is when text mixes sequences of characters written from left to right (LTR) with sequences of characters written in the opposite direction (right to left, RTL). </p> <p> An example of bidirectional text is the content of the <code class="language-html">&lt;span&gt;</code> element: </p> <pre><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">&gt;</span></span>The word מחשב means ‘computer’.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span></code></pre> <p> <i>מחשב</i> is in Hebrew, in which words are written and read from right to left. </p> <p> For now, I’ll remove the quotes and the full stop from the example. This is for simplicity: we’ll return to these characters later. </p> <p> We could say that the presence of the RTL word breaks the sentence into three groups: </p> <img src="/images/8.6.1-directional-runs.svg" alt="Three arrows drawn below the sentence “The word מחשב means computer”.
    The first arrow is placed under “The word” and points to the right. The
    second arrow is placed under “מחשב” and points to the left. The third
    arrow is placed under “means computer”."> <p> Each of the groups is called a <dfn>directional run</dfn>: a group of adjacent characters with the same writing direction. </p> <p> Just like individual characters can be displayed right to left, as in מחשב, so can whole directional runs. In the sentence above, the directional runs are displayed from left left to right: run&nbsp;1 → run&nbsp;2 → run&nbsp;3. However, it’s possible to change the direction to RTL: run&nbsp;3 → run&nbsp;2 → run&nbsp;1. This ordering is used in languages such as Arabic and Hebrew. </p> <p> For an example, let’s use the code below. Note the addition of the attribute <code class="language-html">dir</code>. </p> <pre><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">dir</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>rtl<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>The word מחשב means computer<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span></code></pre> <p> The attribute defines the so-called <dfn>base direction</dfn>. This is the fundamental direction which specifies, among other things, the order in which the directional runs are to be displayed. The result is as follows: </p> <div id="ex-8.6.1-i" class="example-visualization"> <div class="example-frame"> <span dir="rtl">The word מחשב means computer</span> </div> </div> <p> Keeping the result above in mind, let’s look at a fragment of <a href="https://www.w3.org/TR/CSS22/visuren.html#direction">Section&nbsp;9.10</a>: </p> <blockquote> Please note that in order to be able to flow inline boxes in a uniform direction (either entirely left-to-right or entirely right-to-left), … some inline boxes may have to be split up and reordered before flowing. </blockquote> <p> The fragment tells us that to achieve the ordering of run&nbsp;3 → run&nbsp;2 → run&nbsp;1, the browser might have broken up the inline box for the <code class="language-html">&lt;span&gt;</code> element into three inline boxes, then reorder them: </p> <img src="/images/8.6.1-multiple-line-boxes.svg" alt="The sentence “The word מחשב means computer” is broken down into 
    three inline boxes: first for “The word”, second for “מחשב”, and third
    for “means computer”. The inline boxes are then ordered from right to 
    left, so the result is “means computer מחשב The word”."> <p> Note that there are two distinct orders. One is the order in which the boxes are defined: box&nbsp;1, box&nbsp;2, box&nbsp;3. This is the <dfn>logical order</dfn>. The other order is one in which the boxes are displayed. This is the <dfn>visual order</dfn>. With <code class="language-html">dir="rtl"</code>, the visual order is box&nbsp;3, box&nbsp;2, box&nbsp;1. </p> <p> With this information, let’s look at the fragment of the spec we’re discussing: </p> <blockquote> For each line box, UAs must take the inline boxes generated for each element and render the margins, borders and padding in visual order (not logical order). </blockquote> <p> To see how the rule above works, we’ll add a left and a right border to the <code class="language-html">&lt;span&gt;</code> element: </p> <pre><code class="language-css"><span class="token selector">span</span> <span class="token punctuation">{</span>
  <span class="token property">border-left</span><span class="token punctuation">:</span> 2px solid #705697<span class="token punctuation">;</span>
  <span class="token property">border-right</span><span class="token punctuation">:</span> 2px solid #ffbeb5<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre> <p> If the borders were applied in logical order, we would expect the following effect: </p> <img src="/images/8.6.1-line-boxes-border-applied-in-logical-order.svg" alt="An inline element with the content “The word מחשב means computer”. The element 
has the HTML property dir=&quot;rtl&quot;. Because of the presence of bidirectional 
text, the inline box for the element is split into three: 1: [The word], 2: [ מחשב ], 
3: [means computer]. If borders were applied in logical order, the right border would
be displayed on box&nbsp;1, while the left border would be displayed on box&nbsp;3.
With dir=&quot;rtl&quot;, the borders will thus be placed inside the sentence."> <p> That is, the left border would be applied to the logically leftmost line box, while the right border would be applied to the logically rightmost line box. </p> <p> This doesn’t look very good. For this reason, CSS requires applying borders (as well as paddings and margins) in visual order. This is the effect: </p> <div id="ex-8.6.1-ii" class="example-visualization"> <style> #ex-8\.6\.1-ii span {
          border-left: 5px solid #705697;
          border-right: 5px solid #ffbeb5;
        } </style> <div class="example-frame"> <span dir="rtl">The word מחשב means computer</span> </div> </div> <p> I have focused here on bidirectional text only to the extent in which it was necessary to explain the fragment of the spec. However, the topic is much broader. For example, punctuation and some other characters behave in a special way in bidirectional text. To see this, let’s bring back the quotes and the full stop to the example: </p> <div id="ex-8.6.1-iii" class="example-visualization"> <div class="example-frame"> <span dir="rtl">The word מחשב means ‘computer’.</span> </div> </div> <p> Your browser should display the full stop at the leftmost side of the sentence. Similarly, one quote should be tucked on the left of <i>computer</i>, and another on the left of <i>means</i>. This behaviour is prescribed by the complex bidirectional algorithm specified in <a href="https://www.unicode.org/reports/tr9/">Annex&nbsp;9 to the Unicode standard</a>. </p> <p> W3C has some excellent introductory articles on the topic of bidirectional text handling. For example, I recommend <cite><a href="https://www.w3.org/International/articles/inline-bidi-markup/uba-basics">Unicode Bidirectional Algorithm basics</a></cite> as an approachable introduction. </p> </div> <div class="copyright-notice"> <p> <img alt="Creative Commons License" src="/images/CC_BY-SA_small.svg"> This work by <span xmlns:cc="http://creativecommons.org/ns#" property="cc:attributionName">Mateusz Sarnecki</span> is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a>. </p> </div> </article> </main> <script src="/scripts/main.js"></script> <!-- GoatCounter, privacy-sensitive web analytics --> <script data-goatcounter="https://msar.goatcounter.com/count" async="" src="//gc.zgo.at/count.js"></script> </body></html>