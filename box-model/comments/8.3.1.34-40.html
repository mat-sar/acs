<html lang="en"><head> <meta charset="utf-8"> <title> Margins collapsing through a box | Annotated CSS Spec </title> <meta name="description" content="Broaden your CSS knowledge by reading a specification enriched with explanations and examples."> <meta name="viewport" content="width=device-width,initial-scale=1"> <meta property="og:title" content="Annotated CSS Spec"> <meta property="og:url" content="https://annotatedcss.com"> <meta property="og:description" content="Broaden your CSS knowledge by reading an annotated specification!"> <meta property="og:image" content="/images/logo.png"> <meta property="og:type" content="website"> <meta property="og:image:width" content="300"> <meta property="og:image:height" content="300"> <link href="https://fonts.googleapis.com/css2?family=Inconsolata&amp;family=Open+Sans:ital,wght@0,400;0,600;1,300;1,400&amp;display=swap" rel="stylesheet"> <link rel="canonical" href="https://annotatedcss.com/box-model/comments/8.3.1.34-40_collapse-through.html"> <link rel="stylesheet" href="/styles/main.css"> <link rel="icon" type="image/png" href="/images/favicon-16x16.png" sizes="16x16"> <link rel="icon" type="image/png" href="/images/favicon-32x32.png" sizes="32x32"> <link rel="icon" type="image/png" href="/images/favicon-96x96.png" sizes="96x96"> </head> <body> <header> <svg class="logo" xmlns="http://www.w3.org/2000/svg" width="50" height="50" viewBox="0 0 41.01 41.01"><g class="marginBox" fill="none" stroke="#ececfb" stroke-width="2.646"><path d="M1.323 7.938V1.323h6.615M1.323 11.898v6.614M1.323 22.488v6.614M7.937 39.688H1.323v-6.615M39.688 7.938V1.323h-6.615M39.688 11.898v6.614M39.688 22.488v6.614M33.073 39.688h6.614v-6.615M11.906 1.318h6.615M22.49 1.318h6.614M11.906 39.688h6.615M22.49 39.688h6.614"></path></g><rect class="borderBox" ry="0" height="25.261" width="25.261" y="7.87" x="7.875" opacity=".99" fill="none" stroke="#ececfb" stroke-width="2.52" stroke-linecap="round"></rect><rect class="contentBox" ry="0" height="14.552" width="14.552" y="13.23" x="13.229" opacity=".99" fill="#c7a6e7ff"></rect></svg> <a class="title" href="/">Annotated CSS&nbsp;Spec </a><a class="help-link" href="/about">?</a> </header> <main> <article class="spec-comment open" data-comment-on="/box-model.html"> <div class="content"> <div class="comment-identifier"> <p> This comment relates to the following words from Section&nbsp;8.3.1 of CSS&nbsp;2.2: </p> <blockquote> <p> If the top and bottom margins of a box are adjoining, then it is possible for margins to <dfn>collapse through</dfn> it. In this case, the position of the element depends on its relationship with the other elements whose margins are being collapsed. </p> <ul> <li> If the element's margins are collapsed with its parent's top margin, the top border edge of the box is defined to be the same as the parent's. </li> <li> Otherwise, either the element's parent is not taking part in the margin collapsing, or only the parent's bottom margin is involved. The position of the element's top border edge is the same as it would have been if the element had a non-zero bottom border. </li> </ul> </blockquote> </div> <p> When margins collapse, it is usually obvious what the position of the resulting margin will be. I say “usually” because of one exception. This is a type of margin collapse which I call own margin collapse. </p> <p> As discussed in <a href="/box-model/comments/8.3.1.16">another comment</a>, own margin collapse takes place between the top and the bottom margin of a box that satisfies several criteria. Among other things, the box cannot have any content, any height, any padding, or any borders. In such a situation, the top and the bottom margin will be adjoining. </p> <img src="/images/8.3.1.34-40-empty-box-without-own-margin-collapse.svg" alt="A box with positive top and bottom margins. The box does not have any content,
      padding, or borders. However, the margins do not collapse (e.g. because the box
      establishes a new block formatting context)."> <p> When the top and the bottom margins of the box above collapse, there is no obvious position in which the collapsed margin should be placed. The following diagram presents a few conceivable options. </p> <img src="/images/8.3.1.34-40-hypothetical-margin-positions.svg" alt="Three positions in which a margin resulting from own margin collapse
      can be placed with respect to the box. In the first position, the collapsed
      margin extends above the top border edge of the box. In the second position,
      the box intersects the collapsed box in the middle. In the third position,
      the collapsed margin extends below the bottom border edge of the box."> <p> The spec makes it clear what positioning is to be used by browsers: we will look at these rules in a moment. </p> <p> We can observe that in all these hypothetical scenarios, at least one margin has to “cut” through the box to collapse with the other margin. This is what the specification describes as margins <em>collapsing through</em> the box. </p> <p> Note that the spec says that (emphasis mine) <q>it is <em>possible</em> for margins to collapse through</q> a box that undergoes own margin collapse. The wording indicates that there are situations in which own margin collapse does not lead to collapse-through. </p> <p> As an example, consider a self-collapsing box in which the top margin is is 10&nbsp;px, while the bottom margin is −10&nbsp;px. In this case, the collapsed margin is zero. </p> <p> After introducing the concept of margins collapsing through a box, the spec lists two rules for determining the position of a box which undergoes collapse-through. In general, that position depends on whether the margins of the box collapse with the top margin of the parent. </p> <p> Let’s start from the following set⁠-⁠up: </p> <img src="/images/8.3.1.34-40-box-set-up.svg" alt="A parent box and two child boxes. The parent box has a top margin of 20 px,
      the first child box has a top and bottom margin of 10 px each, and the second child
      has a top margin of 20 px. The first child has no border, no content, no height and
      no padding."> <p> The diagram above presents the arrangement of boxes if margin collapse did not exist. Now, let’s assume that we allow all margins to collapse: </p> <img src="/images/8.3.1.34-40-all-margins-collapsing.svg" alt="A parent box and two child boxes. The parent box has a top margin, the first child
      box has a top and bottom margin, and the second child has a top margin. The first child
      has no border, no content, no height and no padding. All margins collapse, with the result
      that the border edges of all three boxes are aligned at the top, with the collapsed margin
      of 20 px extending above them."> <p> As dictated by the spec, the self-collapsing box, i.e.&nbsp;the first child in our example, is positioned such that its top border edge is the same as the top border edge of the parent. This positioning is mandated when the margins of the self-collapsing box collapse with the top margin of the parent. </p> <p> Now, let’s prevent the parent’s top margin from collapsing with the margins of the first child. This can be achieved by setting a top border on the parent: </p> <img src="/images/8.3.1.34-40-top-border-on-parent.svg" alt="A parent box and two child boxes. The first child has a top and a bottom margin which
      collapse with the top margin of the second child, forming a single margin of 20 px. The parent
      box has a top margin of 20 px which does not participate in the collapse because the parent
      has a non-zero top border. The first child is positioned 10 px below the top border of the
      parent box."> <p> The margins of the first child no longer collapse with the top margin of the parent. In this situation, the spec mandates a different positioning scheme: <q>The position of the element's top border edge is the same as it would have been if the element had a non⁠-⁠zero bottom border.</q> </p> <p> That is, to find the position of the first child in our example, we need to assume that this child has a non⁠-⁠zero bottom border. The presence of a non⁠-⁠zero bottom border would prevent the box’s top and bottom margins from collapsing. This means we have to ask: what would be the position of the self-collapsing box if this box didn’t undergo own margin collapse? </p> <p> The following diagram presents how this positioning logic is applied to our example. </p> <img src="/images/8.3.1.34-40-box-position-calculation.svg" alt="Two steps for finding the position of a box which undergoes own margin
      collapse and whose margins do not collapse with the top margin of the box’s
      parent. In the first step, the position of the collapsed margin is established.
      In the second step, the position of the box which undergoes own margin collapse
      is calculated, based on the assumption that the box had a non-zero bottom
      border. Finally, the position of the collapsed margin from the first step
      is combined with the position of the self-collapsing box from the second step."> <p> The middle part of the diagram depicts the arrangement of boxes if the first child had a non⁠-⁠zero bottom border. In this situation, the child would be placed 10 pixels below the top border of the parent. So, this is where the child box is ultimately placed. </p> <p> Importantly, the position of the first child does not affect the position of the second child. This is according to the principle expressed by the spec: <q>the positions of elements that have been collapsed through have no effect on the positions of the other elements with whose margins they are being collapsed</q>. </p> <p> As the spec continues to explain, the positioning of the self-collapsing box is <q>only required for laying out descendants of these elements</q>. A good illustration of this is adding a float to the first child from our example. Floats are ignored in the calculation of their parents’ height. This means that the first child, even though it will contain a float, will still have a zero height, and so it will still undergo own margin collapse. The browser will use the position of that first child to determine where to place the float. </p> <p> You can see this in the example below. </p> <div id="ex-8.3.1.34-40-i" class="example-visualization"> <style> #ex-8\.3\.1\.34-40-i .first-child {
          margin: 10px 20px;
        }

        #ex-8\.3\.1\.34-40-i .float {
          display: none;
        }

        #ex-8\.3\.1\.34-40-i .second-child {
          background-color: #705697;
          color: #f3eafb;
          height: 20px;
          line-height: 20px;
          margin: 20px;
        }

        #ex-8\.3\.1\.34-40-i .parent {
          background-color: #dfdff9;
        }

        #ex-8\.3\.1\.34-40-i-add-border:checked ~ .example-frame .parent {
          border-top: 1px solid #686892;
        }

        #ex-8\.3\.1\.34-40-i-add-float:checked ~ .example-frame .parent .float {
          background-color: #5c004eaf;
          color: #f3eafb;
          display: block;
          float: left;
          height: 50px;
          width: 50px;
        }

        #ex-8\.3\.1\.34-40-i-show-outline:checked
          ~ .example-frame
          .parent
          .first-child {
          outline: 1px red solid;
        } </style> <input id="ex-8.3.1.34-40-i-show-outline" type="checkbox"><label for="ex-8.3.1.34-40-i-show-outline">Show the outline of the self-collapsing box</label><br> <input id="ex-8.3.1.34-40-i-add-border" type="checkbox"><label for="ex-8.3.1.34-40-i-add-border">Add a top border to the parent element</label><br> <input type="checkbox" id="ex-8.3.1.34-40-i-add-float"><label for="ex-8.3.1.34-40-i-add-float">Add a float to the first child</label> <div class="example-frame"> <div class="parent"> <div class="first-child"><div class="float">Float</div></div> <div class="second-child">Second child</div> </div> </div> </div> </div> <div class="copyright-notice"> <p> <img alt="Creative Commons License" src="/images/CC_BY-SA_small.svg"> This work by <span xmlns:cc="http://creativecommons.org/ns#" property="cc:attributionName">Mateusz Sarnecki</span> is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a>. </p> </div> </article> </main> <script src="/scripts/main.js"></script> <!-- GoatCounter, privacy-sensitive web analytics --> <script data-goatcounter="https://msar.goatcounter.com/count" async="" src="//gc.zgo.at/count.js"></script> </body></html>